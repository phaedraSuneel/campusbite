<div class="col-md-4 cart-container">
  <div class="cart-recored">
    <div class="cart-btn">Your cart</div>
    <% if user_signed_in? %>
      <% cart=current_user.cart %>
    <% else %>
      <% cart=Cart.find_by_token(cookies[:cart_token]) %>
    <% end %>

    <% unless cart.blank? %>
      <%= form_for "order", :url => create_order_carts_path, :method => :get, :html => {:class => "order-form"} do |f|%>
        <div class="row asap">
          <div class="col-md-4 order-type">
            Order type:
          </div>
          <div class="col-md-4 delivery-type">
            <div class="delivery-btn">
              <%= f.radio_button :order_type , "delivery"%> Delivery
            </div>
          </div>
          <div class="col-md-4 pickup-type">
            <div class="pick-btn">
              <%= f.radio_button :order_type , "pickup" %> Pickup</div>
          </div>
          <div class="col-md-12 request-order">
            <label>Order Requested For:<span><%= f.text_field :request_time, :value => "ASAP",  :disabled => "disabled", :class => "order_request_field" %></span><a href="javascript:void(0)" class="edit-order-link" >Edit</a></label>
          </div>
          <% cart.cart_menu_items.each do |cart| %>
            <div class="col-md-12 Qty-container">
              <div class="back-border">
                <label class="edit-cloes"><a href="#">Eidt</a><span><a class="cloesing" href="#">X</a></span></label>
                <label class="dolor-heading"><%= cart.menu_item.item_name %><span>$<%= cart.menu_item.price %></span></label>
                <% cart_extra_charges = 0 %>
                <% if cart.menu_item_property_id %>
                  <% cart_extra_charges = cart.property_price(cart.menu_item_property_id) %>
                  <label class="details"><%= cart.property_name(cart.menu_item_property_id)%><span>$<%= cart_extra_charges %></span></label>
                <% end %>
                <label class="details">Instructions:  <%= cart.instruction %></label>
                <label class="total-amount"><img class="line-1" alt="Smiley face" src="/assets/t-line.png" /><span class="item-total" id="cart_menu_item_<%=cart.id%>">$ <%= (cart.menu_item.price + cart_extra_charges) * cart.quantity %></span></label>
                <label class="qty-amount">QTY:<span><%= link_to '-', 'javascript:void(0)', :class => "minus-quantiy", :remote => true %></span><span class="quantity" data-cart = "<%= cart.id %>"><%= cart.quantity %></span><%= link_to '+', 'javascript:void(0)', :class => "plus-quantiy", :remote => true%></label>
                  <div class="result"></div>
              </div>
            </div>
          <% end %>  
          <div class="col-md-12 subtotal-container">
            <div class="subtotal-head">
              <label>Subtotal:</label>
              <label>Tax:</label>
              <label>Delivery Fee:</label>
            </div>
            <div class="subtotal-amount">
              <label>$43.50</label>
              <label>$1.43</label>
              <label>$4.00</label>
            </div>
          </div>
          <div class="col-md-12 grandtotal-container">
            <label>TOTAL:<span>$48.50</span></label>
          </div>
          <div class="col-md-8 col-md-offset-2 checkout-btn">
            <%= link_to raw("<button>CHECKOUT</button>"), "#", :class => "checkout-btn-link", :remote => true %>
          </div>
        </div>
      <% end %>  
    <% else %>
      <div class="text-center"> Your Cart is Empty</div>
    <% end %>    
  </div>
</div>


<script type="text/javascript">
  $(document).ready(function(){
    $(".edit-order-link").click(function(){
      $(".order_request_field").attr("disabled", false);
      $(".order_request_field").css("border", "2px inset");
    });

    $(".plus-quantiy").click(function(){
      quantity_area =  $(this).parent().find(".quantity");
      id = quantity_area.data("cart");
      quantity = parseInt(quantity_area.text());
      quantity ++;  
      quantity_area.text(quantity);
      $.ajax ({
        url:  '/carts/update_cart_item_quantity',
        data: {id: id, quantity: quantity },
        success: function(data)
        {
          quantity_area.text(quantity);
          $(".item-total").text(data.html);
        }
      });


    });

    $(".minus-quantiy").click(function(){
      quantity_area =  $(this).parent().parent().find(".quantity");
      id = quantity_area.data("cart");
      quantity = parseInt(quantity_area.text());
      if(quantity!=0)
        quantity --;  
      $.ajax ({
        url:  '/carts/update_cart_item_quantity',
        data: {id: id, quantity: quantity },
        success: function(data)
        {
          quantity_area.text(quantity);
          $(".item-total").text(data.html);
        }
      });
    });

  });
</script>